(this["webpackJsonpav-chat"]=this["webpackJsonpav-chat"]||[]).push([[0],{34:function(e,t,n){e.exports=n(73)},39:function(e,t,n){},69:function(e,t){},73:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(31),s=n.n(c),o=(n(72),n(39),n(1)),u=n.n(o),i=n(2),l=n(10),p=n(33),d=n.n(p),f=[{urls:"stun:stun01.sipphone.com"},{urls:"stun:stun.ekiga.net"},{urls:"stun:stun.fwdnet.net"},{urls:"stun:stun.ideasip.com"},{urls:"stun:stun.iptel.org"},{urls:"stun:stun.rixtelecom.se"},{urls:"stun:stun.schlund.de"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stunserver.org"},{urls:"stun:stun.softjoys.com"},{urls:"stun:stun.voiparound.com"},{urls:"stun:stun.voipbuster.com"},{urls:"stun:stun.voipstunt.com"},{urls:"stun:stun.voxgratia.org"},{urls:"stun:stun.xten.com"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"},{urls:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"},{urls:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}],m=Object({NODE_ENV:"production",PUBLIC_URL:"/build",REACT_APP_SOCKET_URL:"wss://www.xingyibiao.com/"}),b=m.REACT_APP_SOCKET_URL,v=m.NODE_ENV,g=b||"",h="production"===v?"/chat/socket.io":"/socket.io",k=function(){var e=Object(r.useRef)(null),t=Object(r.useRef)(null),n=Object(r.useRef)(null),c=Object(r.useState)(""),s=Object(l.a)(c,2),o=s[0],p=s[1],m=Object(r.useState)(""),b=Object(l.a)(m,2),v=b[0],k=b[1],x=Object(r.useState)(""),w=Object(l.a)(x,2),E=w[0],O=w[1],j=null,y=null,C=!0,R=!1,_=new RTCPeerConnection({iceServers:f});console.log(g,h);var A=d()(g,{path:h,forceNew:!0,reconnection:!1,transports:["websocket"]});function P(){return L.apply(this,arguments)}function L(){return(L=Object(i.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!R){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,_.createOffer();case 5:if(t=e.sent,R=!0,console.log("\u521b\u5efaoffer",t),!t.sdp){e.next=12;break}return e.next=11,_.setLocalDescription(t);case 11:A.emit("send_sdp",t);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})))).apply(this,arguments)}function S(){return T.apply(this,arguments)}function T(){return(T=Object(i.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!R){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,_.createAnswer();case 5:if(t=e.sent,R=!0,console.log("\u521b\u5efaanswer",t),!t.sdp){e.next=12;break}return e.next=11,_.setLocalDescription(t);case 11:A.emit("send_sdp",t);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=Object(i.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j){e.next=2;break}return e.abrupt("return");case 2:if(j.getTracks().forEach((function(e){j&&_.addTrack(e,j)})),!C){e.next=8;break}return e.next=6,P();case 6:e.next=10;break;case 8:return e.next=10,S();case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(){return(U=Object(i.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C=!0,e.next=3,D();case 3:A.emit("call");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return _.addEventListener("track",(function(e){console.log("\u8fdc\u7aeftrack\u589e\u52a0",e.streams);var n=t.current;console.log(n),y=e.streams[0],n&&n.srcObject!==e.streams[0]&&(console.log(j,y),n.srcObject=y)})),_.addEventListener("icecandidate",(function(e){console.log("ice",e),A.emit("candidate",e.candidate)})),A.on("send_sdp",function(){var e=Object(i.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.sender,r=t.data,console.log("\u6536\u5230sdp",t),n!==v){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,_.setRemoteDescription(r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),A.on("candidate",function(){var e=Object(i.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.sender,r=t.data,n!==v){e.next=3;break}return e.abrupt("return");case 3:if(r){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,console.log(r),e.next=9,_.addIceCandidate(r);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(5),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}()),A.on("call",(function(e){if(e.sender!==v){var t=n.current;t&&(t.disabled=!0),C=!1,D()}})),_.addEventListener("negotiationneeded",(function(e){console.log("rtc state",_.signalingState),_.signalingState})),a.a.createElement("div",{className:"App"},a.a.createElement("input",{type:"text",value:v,onChange:function(e){return k(e.target.value)}}),a.a.createElement("input",{type:"text",value:E,onChange:function(e){return O(e.target.value)}}),a.a.createElement("button",{onClick:function(){navigator.getUserMedia({video:!0},(function(e){console.log(e),p(e.id)}),(function(e){console.error(e)}))}},"\u83b7\u53d6\u6444\u50cf\u5934"),a.a.createElement("button",{onClick:function(){navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(t){e.current&&(e.current.srcObject=t,j=t)})).catch((function(e){console.error(e)}))}},"\u91c7\u96c6\u672c\u5730\u89c6\u9891"),a.a.createElement("button",{onClick:function(){A.emit("login",v,E,(function(e){C=e,console.log("\u662f\u4e0d\u662f\u53d1\u5e03\u8005",e)}))}},"\u767b\u5f55\u623f\u95f4"),a.a.createElement("button",{ref:n,onClick:function(){return U.apply(this,arguments)}},"call"),a.a.createElement("span",null,o),a.a.createElement("video",{ref:e,width:"500",height:"500",autoPlay:!0,muted:!0}),a.a.createElement("video",{ref:t,width:"500",height:"500",autoPlay:!0}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(a.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[34,1,2]]]);
//# sourceMappingURL=main.0ab76f75.chunk.js.map