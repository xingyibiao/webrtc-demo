(this["webpackJsonpav-chat"]=this["webpackJsonpav-chat"]||[]).push([[0],{34:function(e,t,n){e.exports=n(73)},39:function(e,t,n){},69:function(e,t){},73:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(31),s=n.n(o),c=(n(72),n(39),n(1)),u=n.n(c),i=n(5),l=n(10),d=n(33),p=n.n(d),f=[{urls:"stun:stun01.sipphone.com"},{urls:"stun:stun.ekiga.net"},{urls:"stun:stun.fwdnet.net"},{urls:"stun:stun.ideasip.com"},{urls:"stun:stun.iptel.org"},{urls:"stun:stun.rixtelecom.se"},{urls:"stun:stun.schlund.de"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stunserver.org"},{urls:"stun:stun.softjoys.com"},{urls:"stun:stun.voiparound.com"},{urls:"stun:stun.voipbuster.com"},{urls:"stun:stun.voipstunt.com"},{urls:"stun:stun.voxgratia.org"},{urls:"stun:stun.xten.com"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"},{urls:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"},{urls:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}],m=function(){var e=Object(r.useRef)(null),t=Object(r.useRef)(null),n=Object(r.useState)(""),o=Object(l.a)(n,2),s=o[0],c=o[1],d=Object(r.useState)(""),m=Object(l.a)(d,2),g=m[0],v=m[1],b=Object(r.useState)(""),h=Object(l.a)(b,2),k=h[0],w=h[1],x=null,E=null,O=!0,j=!1,y=new RTCPeerConnection({iceServers:f}),C=p()("https://www.xingyibiao.com/",{path:"/chat/socket.io",forceNew:!0,reconnection:!1,transports:["websocket"],rejectUnauthorized:!1});function A(){return(A=Object(i.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,y.createOffer();case 5:if(t=e.sent,j=!0,console.log("\u521b\u5efaoffer",t),!t.sdp){e.next=12;break}return e.next=11,y.setLocalDescription(t);case 11:C.emit("send_sdp",t);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})))).apply(this,arguments)}function R(){return S.apply(this,arguments)}function S(){return(S=Object(i.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,y.createAnswer();case 5:if(t=e.sent,j=!0,console.log("\u521b\u5efaanswer",t),!t.sdp){e.next=12;break}return e.next=11,y.setLocalDescription(t);case 11:C.emit("send_sdp",t);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})))).apply(this,arguments)}return y.addEventListener("track",(function(e){console.log("\u8fdc\u7aeftrack\u589e\u52a0",e.streams);var n=t.current;console.log(n),E=e.streams[0],n&&n.srcObject!==e.streams[0]&&(console.log(x,E),n.srcObject=x)})),y.addEventListener("icecandidate",(function(e){console.log("ice",e),C.emit("candidate",e)})),C.on("send_sdp",function(){var e=Object(i.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.sender,r=t.data,console.log("\u6536\u5230sdp",t),n!==g){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,y.setRemoteDescription(r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),C.on("candidate",function(){var e=Object(i.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.sender,r=t.data,n!==g){e.next=3;break}return e.abrupt("return");case 3:if(r.candidate){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,console.log(r),e.next=9,y.addIceCandidate(r.candidate);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(5),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}()),y.addEventListener("negotiationneeded",(function(e){console.log("rtc state",y.signalingState),y.signalingState})),a.a.createElement("div",{className:"App"},a.a.createElement("input",{type:"text",value:g,onChange:function(e){return v(e.target.value)}}),a.a.createElement("input",{type:"text",value:k,onChange:function(e){return w(e.target.value)}}),a.a.createElement("button",{onClick:function(){navigator.getUserMedia({video:!0},(function(e){console.log(e),c(e.id)}),(function(e){console.error(e)}))}},"\u83b7\u53d6\u6444\u50cf\u5934"),a.a.createElement("button",{onClick:function(){navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(t){e.current&&(e.current.srcObject=t,x=t)})).catch((function(e){console.error(e)}))}},"\u91c7\u96c6\u672c\u5730\u89c6\u9891"),a.a.createElement("button",{onClick:function(){C.emit("login",g,k,(function(e){O=e,console.log("\u662f\u4e0d\u662f\u53d1\u5e03\u8005",e)}))}},"\u767b\u5f55\u623f\u95f4"),a.a.createElement("button",{onClick:function(){x&&(x.getTracks().forEach((function(e){x&&y.addTrack(e,x)})),O?function(){return A.apply(this,arguments)}().catch((function(){return R()})):R())}},"\u53d1\u5e03\u6d41"),a.a.createElement("span",null,s),a.a.createElement("video",{ref:e,width:"500",height:"500",autoPlay:!0,muted:!0}),a.a.createElement("video",{ref:t,width:"500",height:"500",autoPlay:!0}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(a.a.createElement(m,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[34,1,2]]]);
//# sourceMappingURL=main.467edd76.chunk.js.map